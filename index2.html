<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Trading Dashboard (IBKR CSV)</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 0; background:#0b0f17; color:#e8eefc;}
    .wrap { max-width: 1200px; margin: 0 auto; padding: 18px 18px 40px;}
    h1 { font-size: 20px; margin: 0 0 6px;}
    .sub { color:#aab6d6; font-size: 13px; margin-bottom: 16px;}
    .controls { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 14px; }
    .card { background:#121a2a; border:1px solid #223055; border-radius: 12px; padding: 12px; }
    label { display:block; font-size: 12px; color:#aab6d6; margin-bottom: 6px;}
    select, input { width:100%; padding: 10px; border-radius: 10px; border:1px solid #223055; background:#0e1526; color:#e8eefc; }
    .kpis { display:grid; grid-template-columns: repeat(8, 1fr); gap: 10px; margin: 14px 0; }
    .kpi { background:#121a2a; border:1px solid #223055; border-radius: 12px; padding: 12px; }
    .kpi .v { font-size: 18px; font-weight: 700; margin-top: 6px;}
    .kpi .k { font-size: 12px; color:#aab6d6;}
    .grid { display:grid; grid-template-columns: 1.2fr 0.8fr; gap: 12px; }
    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
    .plot { height: 380px; }
    .plot.small { height: 340px; }
    .err { display:none; background:#2a1a1a; border:1px solid #6b2d2d; color:#ffd9d9; padding:12px; border-radius:12px; margin:12px 0;}
    @media (max-width: 1020px) {
      .kpis { grid-template-columns: repeat(2, 1fr); }
      .grid, .grid2 { grid-template-columns: 1fr; }
      .controls { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Trading Dashboard (IBKR CSV)</h1>
    <div class="sub">Datos: Trades (cierres) agregados por combo de cierre + Open Positions para P/L no realizado.</div>

    <div id="err" class="err"></div>

    <div class="controls">
      <div class="card">
        <label>Estrategias (multi-select)</label>
        <select id="strategy" multiple size="7"><option value="BCS (Bull Call Debit Spread)" selected>BCS (Bull Call Debit Spread)</option><option value="CCS (Bear Call Credit Spread)" selected>CCS (Bear Call Credit Spread)</option><option value="Covered Call" selected>Covered Call</option><option value="Iron Condor" selected>Iron Condor</option><option value="Long Call" selected>Long Call</option><option value="Long Put" selected>Long Put</option><option value="Multi-leg (2 legs)" selected>Multi-leg (2 legs)</option><option value="Multi-leg (3 legs)" selected>Multi-leg (3 legs)</option><option value="Multi-leg (4 legs)" selected>Multi-leg (4 legs)</option><option value="Multi-leg (5 legs)" selected>Multi-leg (5 legs)</option><option value="PCS (Bull Put Credit Spread)" selected>PCS (Bull Put Credit Spread)</option><option value="PDS (Bear Put Debit Spread)" selected>PDS (Bear Put Debit Spread)</option><option value="Short Call" selected>Short Call</option><option value="Short Put" selected>Short Put</option><option value="Stock" selected>Stock</option></select>
      </div>
      <div class="card">
        <label>Activos (multi-select)</label>
        <select id="underlying" multiple size="7"><option value="AMD" selected>AMD</option><option value="AMZN" selected>AMZN</option><option value="BABA" selected>BABA</option><option value="BBWI" selected>BBWI</option><option value="BJ" selected>BJ</option><option value="CL" selected>CL</option><option value="CMG" selected>CMG</option><option value="CRM" selected>CRM</option><option value="CSCO" selected>CSCO</option><option value="GLD" selected>GLD</option><option value="GM" selected>GM</option><option value="GOOG" selected>GOOG</option><option value="GOOGL" selected>GOOGL</option><option value="GS" selected>GS</option><option value="IAU" selected>IAU</option><option value="IBIT" selected>IBIT</option><option value="INTC" selected>INTC</option><option value="JPM" selected>JPM</option><option value="KHC" selected>KHC</option><option value="KMI" selected>KMI</option><option value="KO" selected>KO</option><option value="KR" selected>KR</option><option value="LULU" selected>LULU</option><option value="MARA" selected>MARA</option><option value="META" selected>META</option><option value="MRK" selected>MRK</option><option value="NCLH" selected>NCLH</option><option value="NFLX" selected>NFLX</option><option value="NKE" selected>NKE</option><option value="NVS" selected>NVS</option><option value="ORCL" selected>ORCL</option><option value="PG" selected>PG</option><option value="PYPL" selected>PYPL</option><option value="RBLX" selected>RBLX</option><option value="RCL" selected>RCL</option><option value="RIVN" selected>RIVN</option><option value="SPXW" selected>SPXW</option><option value="SPY" selected>SPY</option><option value="TGT" selected>TGT</option><option value="TSLA" selected>TSLA</option><option value="TXN" selected>TXN</option><option value="UAL" selected>UAL</option><option value="UBER" selected>UBER</option><option value="UPS" selected>UPS</option><option value="XLE" selected>XLE</option><option value="XLU" selected>XLU</option><option value="XP" selected>XP</option></select>
      </div>
      <div class="card">
        <label>Fecha inicio</label>
        <input id="start" type="date" value="2025-08-20"/>
      </div>
      <div class="card">
        <label>Fecha fin</label>
        <input id="end" type="date" value="2026-01-16"/>
      </div>
    </div>

    <div class="kpis">
      <div class="kpi"><div class="k">P/L Realizado</div><div class="v" id="k_pl">$0</div></div>
      <div class="kpi"><div class="k">P/L No Realizado</div><div class="v" id="k_upl">$0</div></div>
      <div class="kpi"><div class="k">Win rate</div><div class="v" id="k_wr">0%</div></div>
      <div class="kpi"><div class="k"># Trades</div><div class="v" id="k_n">0</div></div>
      <div class="kpi"><div class="k">Profit factor</div><div class="v" id="k_pf">0</div></div>
      <div class="kpi"><div class="k">Avg trade</div><div class="v" id="k_avg">$0</div></div>
      <div class="kpi"><div class="k">Avg win trade</div><div class="v" id="k_avg_win">$0</div></div>
      <div class="kpi"><div class="k">Avg loss trade</div><div class="v" id="k_avg_loss">$0</div></div>
    </div>

    <div class="grid">
      <div class="card"><div id="equity" class="plot"></div></div>
      <div class="card"><div id="dist" class="plot"></div></div>
    </div>

    <div class="grid2">
      <div class="card"><div id="byStrategy" class="plot small"></div></div>
      <div class="card"><div id="byUnderlying" class="plot small"></div></div>
    </div>

    <div class="grid2">
      <div class="card"><div id="pieStrategy" class="plot small"></div></div>
      <div class="card"><div id="monthlyPL" class="plot small"></div></div>
    </div>

    <div class="grid3">
      <div class="card"><div id="yearlyPL" class="plot small"></div></div>
    </div>
  </div>

<script>
  const TRADES = [{"dt": "2025-08-20T09:30:11", "underlying": "IAU", "strategy": "Short Put", "realized_pl": 14.89431, "commission": -1.05145}, {"dt": "2025-08-20T09:34:38", "underlying": "TGT", "strategy": "Short Call", "realized_pl": 83.49431, "commission": -0.80145}, {"dt": "2025-08-20T09:49:20", "underlying": "TGT", "strategy": "Short Put", "realized_pl": 26.49431, "commission": -0.70145}, {"dt": "2025-08-20T09:50:17", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 49.78862, "commission": -2.10569}, {"dt": "2025-08-20T09:52:37", "underlying": "TGT", "strategy": "Long Call", "realized_pl": -26.40569, "commission": -0.70424}, {"dt": "2025-08-20T10:15:14", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 39.98862, "commission": -2.50569}, {"dt": "2025-08-20T13:17:01", "underlying": "TGT", "strategy": "Short Put", "realized_pl": 60.24431, "commission": -1.05145}, {"dt": "2025-08-22T10:11:23", "underlying": "TGT", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 50.18861999999999, "commission": -1.4056899999999999}, {"dt": "2025-08-22T10:14:33", "underlying": "TGT", "strategy": "Short Put", "realized_pl": 61.49431, "commission": -0.80145}, {"dt": "2025-08-22T10:15:47", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 34.78862000000001, "commission": -2.10569}, {"dt": "2025-08-25T15:57:15", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 35.588620000000006, "commission": -1.9056899999999999}, {"dt": "2025-08-27T11:14:32", "underlying": "BJ", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 18.78862, "commission": -0.6056900000000001}, {"dt": "2025-08-28T10:12:35", "underlying": "IAU", "strategy": "Short Put", "realized_pl": 40.89431, "commission": -0.05145}, {"dt": "2025-08-28T11:16:38", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 36.98862, "commission": -2.50569}, {"dt": "2025-08-28T15:00:43", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 37.98361999999999, "commission": -1.9056899999999999}, {"dt": "2025-08-29T09:48:57", "underlying": "UPS", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 40.18861999999999, "commission": -1.4056899999999999}, {"dt": "2025-09-02T09:39:42", "underlying": "SPY", "strategy": "Iron Condor", "realized_pl": 25.980439999999994, "commission": -4.2081800000000005}, {"dt": "2025-09-02T09:42:41", "underlying": "TGT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 26.190219999999997, "commission": -1.40409}, {"dt": "2025-09-02T11:18:07", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 63.61022, "commission": -1.9840900000000001}, {"dt": "2025-09-02T15:02:04", "underlying": "BBWI", "strategy": "Short Put", "realized_pl": 29.89511, "commission": -0.05065}, {"dt": "2025-09-04T16:11:05", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 30.410219999999995, "commission": -2.50409}, {"dt": "2025-09-05T09:35:54", "underlying": "PYPL", "strategy": "Short Put", "realized_pl": 45.14591, "commission": -1.05065}, {"dt": "2025-09-05T13:05:59", "underlying": "SPY", "strategy": "Iron Condor", "realized_pl": 59.02044000000001, "commission": -6.16818}, {"dt": "2025-09-08T12:12:30", "underlying": "UAL", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 35.19182000000001, "commission": -1.40409}, {"dt": "2025-09-09T10:32:57", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 3.510220000000004, "commission": -1.40409}, {"dt": "2025-09-10T10:47:41", "underlying": "AMD", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 47.19182000000001, "commission": -1.40409}, {"dt": "2025-09-11T09:45:00", "underlying": "MRK", "strategy": "Short Put", "realized_pl": 40.14591, "commission": -1.05065}, {"dt": "2025-09-11T09:55:05", "underlying": "TGT", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 3.19182, "commission": -1.40409}, {"dt": "2025-09-11T16:20:00", "underlying": "TGT", "strategy": "Short Put", "realized_pl": 0.0, "commission": 0.0}, {"dt": "2025-09-15T09:35:32", "underlying": "UAL", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 52.19022000000001, "commission": -1.40409}, {"dt": "2025-09-15T09:44:43", "underlying": "PYPL", "strategy": "Short Put", "realized_pl": 34.89591, "commission": -1.05065}, {"dt": "2025-09-15T10:45:37", "underlying": "UPS", "strategy": "Short Put", "realized_pl": 33.14591, "commission": -1.05065}, {"dt": "2025-09-17T11:25:21", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 62.49182, "commission": -2.1040900000000002}, {"dt": "2025-09-17T14:00:02", "underlying": "RIVN", "strategy": "Short Put", "realized_pl": 22.89591, "commission": -1.05065}, {"dt": "2025-09-17T14:13:13", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 36.19182000000001, "commission": -1.40409}, {"dt": "2025-09-17T14:14:13", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -183.80818, "commission": -1.40409}, {"dt": "2025-09-17T14:52:26", "underlying": "TGT", "strategy": "Short Call", "realized_pl": 35.89591, "commission": -1.05065}, {"dt": "2025-09-18T13:41:38", "underlying": "CSCO", "strategy": "Short Put", "realized_pl": 35.89591, "commission": -1.05065}, {"dt": "2025-09-19T10:41:20", "underlying": "TGT", "strategy": "Short Call", "realized_pl": 24.89591, "commission": -1.05065}, {"dt": "2025-09-19T16:20:00", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 42.894310000000004, "commission": 0.0}, {"dt": "2025-09-19T16:20:00", "underlying": "TGT", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 39.59591, "commission": 0.0}, {"dt": "2025-09-22T09:30:50", "underlying": "MRK", "strategy": "Short Put", "realized_pl": 35.89591, "commission": -1.05065}, {"dt": "2025-09-22T11:34:43", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 44.19182000000001, "commission": -1.40409}, {"dt": "2025-09-22T11:34:44", "underlying": "GOOG", "strategy": "Multi-leg (4 legs)", "realized_pl": -381.61636, "commission": -2.80818}, {"dt": "2025-09-22T11:34:45", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -433.80818, "commission": -1.40409}, {"dt": "2025-09-23T09:32:36", "underlying": "CMG", "strategy": "Short Put", "realized_pl": 32.49591, "commission": -0.80065}, {"dt": "2025-09-23T10:42:09", "underlying": "TXN", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 12.191820000000007, "commission": -1.40409}, {"dt": "2025-09-23T13:18:25", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -190.60818, "commission": -2.1040900000000002}, {"dt": "2025-09-24T13:51:36", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 88.19182, "commission": -1.40409}, {"dt": "2025-09-24T15:45:21", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 94.19182, "commission": -1.40409}, {"dt": "2025-09-24T15:45:37", "underlying": "TGT", "strategy": "Short Put", "realized_pl": 47.89591, "commission": -1.05065}, {"dt": "2025-09-25T09:30:01", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 141.51182, "commission": -1.38409}, {"dt": "2025-09-25T09:30:02", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -143.51317999999998, "commission": -2.10909}, {"dt": "2025-09-25T11:07:34", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 45.38682, "commission": -2.50409}, {"dt": "2025-09-25T14:00:32", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 51.45182, "commission": -2.50409}, {"dt": "2025-09-26T15:05:23", "underlying": "UPS", "strategy": "Short Put", "realized_pl": 26.89591, "commission": -1.05065}, {"dt": "2025-09-26T16:20:00", "underlying": "CMG", "strategy": "Multi-leg (2 legs)", "realized_pl": 108.12432000000001, "commission": -0.0166}, {"dt": "2025-09-26T16:20:00", "underlying": "BBWI", "strategy": "Short Put", "realized_pl": 39.94656, "commission": 0.0}, {"dt": "2025-09-26T16:20:00", "underlying": "TGT", "strategy": "Long Put", "realized_pl": -21.05065, "commission": 0.0}, {"dt": "2025-09-29T09:45:22", "underlying": "GOOG", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 58.19182000000001, "commission": -1.40409}, {"dt": "2025-09-29T11:08:17", "underlying": "KO", "strategy": "Short Put", "realized_pl": 27.89591, "commission": -1.05065}, {"dt": "2025-09-29T15:05:39", "underlying": "GOOGL", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 46.19182000000001, "commission": -1.40409}, {"dt": "2025-09-29T15:45:16", "underlying": "TGT", "strategy": "Short Put", "realized_pl": 41.24591, "commission": -1.05065}, {"dt": "2025-09-29T15:58:04", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": 27.89591, "commission": -1.05065}, {"dt": "2025-09-30T09:37:46", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 89.19182, "commission": -1.40409}, {"dt": "2025-09-30T10:00:18", "underlying": "TSLA", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -68.80818, "commission": -1.40409}, {"dt": "2025-09-30T12:09:01", "underlying": "MRK", "strategy": "Short Put", "realized_pl": 37.24591, "commission": -1.05065}, {"dt": "2025-09-30T15:32:03", "underlying": "GOOG", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 42.19182000000001, "commission": -1.40409}, {"dt": "2025-09-30T15:54:39", "underlying": "KR", "strategy": "Short Put", "realized_pl": 35.59591, "commission": -0.70065}, {"dt": "2025-10-01T13:02:06", "underlying": "TSLA", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 42.18132000000003, "commission": -1.41459}, {"dt": "2025-10-01T14:00:30", "underlying": "GOOG", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 25.50132, "commission": -2.09459}, {"dt": "2025-10-02T11:49:12", "underlying": "UPS", "strategy": "Short Put", "realized_pl": 40.90066, "commission": -1.0459}, {"dt": "2025-10-02T15:52:25", "underlying": "TSLA", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 41.20132000000001, "commission": -1.39459}, {"dt": "2025-10-03T10:32:50", "underlying": "CMG", "strategy": "Short Put", "realized_pl": 31.90066, "commission": -1.0459}, {"dt": "2025-10-03T12:51:26", "underlying": "TSLA", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 62.20132000000001, "commission": -1.39459}, {"dt": "2025-10-03T16:20:00", "underlying": "BBWI", "strategy": "Short Put", "realized_pl": 34.94656, "commission": 0.0}, {"dt": "2025-10-03T16:20:00", "underlying": "GOOG", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 37.59591, "commission": 0.0}, {"dt": "2025-10-06T09:40:05", "underlying": "TGT", "strategy": "Short Call", "realized_pl": 34.90066, "commission": -1.0459}, {"dt": "2025-10-06T09:55:52", "underlying": "AMD", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -728.4986799999999, "commission": -1.39459}, {"dt": "2025-10-06T15:01:23", "underlying": "TSLA", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 53.21082000000001, "commission": -1.39459}, {"dt": "2025-10-07T09:35:28", "underlying": "GOOG", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 35.20132000000001, "commission": -1.39459}, {"dt": "2025-10-07T11:48:14", "underlying": "CL", "strategy": "Short Put", "realized_pl": 36.95066, "commission": 0.0041}, {"dt": "2025-10-08T10:02:06", "underlying": "TGT", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 41.50131999999999, "commission": -1.39459}, {"dt": "2025-10-08T10:13:25", "underlying": "META", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 12.510820000000024, "commission": -1.39459}, {"dt": "2025-10-08T10:57:52", "underlying": "GOOGL", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 47.11082, "commission": -2.49459}, {"dt": "2025-10-08T15:04:26", "underlying": "BABA", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 10.63082, "commission": -1.39459}, {"dt": "2025-10-09T09:31:03", "underlying": "BABA", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -158.79868, "commission": -1.39459}, {"dt": "2025-10-09T09:37:16", "underlying": "BABA", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 68.20132000000001, "commission": -1.39459}, {"dt": "2025-10-09T10:47:45", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 38.49632, "commission": -1.39459}, {"dt": "2025-10-10T09:54:23", "underlying": "TGT", "strategy": "Short Call", "realized_pl": 38.39541, "commission": -0.5559}, {"dt": "2025-10-10T11:03:03", "underlying": "TGT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 38.50132, "commission": -2.09459}, {"dt": "2025-10-10T11:31:25", "underlying": "AMD", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 19.210820000000012, "commission": -1.39459}, {"dt": "2025-10-10T11:32:41", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 43.010819999999995, "commission": -1.89459}, {"dt": "2025-10-10T16:20:00", "underlying": "BBWI", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 44.39591, "commission": 0.0}, {"dt": "2025-10-13T13:59:05", "underlying": "GOOG", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 32.50131999999999, "commission": -2.09459}, {"dt": "2025-10-15T10:00:10", "underlying": "TGT", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 49.510819999999995, "commission": -1.39459}, {"dt": "2025-10-15T11:16:10", "underlying": "IBIT", "strategy": "Long Put", "realized_pl": 26.25541, "commission": -1.04869}, {"dt": "2025-10-15T15:18:43", "underlying": "TGT", "strategy": "Short Call", "realized_pl": -38.09709, "commission": -1.0484}, {"dt": "2025-10-16T10:37:10", "underlying": "BABA", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": -108.78917999999999, "commission": -1.39459}, {"dt": "2025-10-17T09:34:04", "underlying": "UPS", "strategy": "Short Put", "realized_pl": 42.15541, "commission": -0.7959}, {"dt": "2025-10-17T15:22:34", "underlying": "TSLA", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 61.510819999999995, "commission": -2.09459}, {"dt": "2025-10-20T09:31:20", "underlying": "NKE", "strategy": "Short Put", "realized_pl": 47.18541, "commission": -0.7659}, {"dt": "2025-10-20T09:37:03", "underlying": "BBWI", "strategy": "Short Put", "realized_pl": 34.90541, "commission": -0.0459}, {"dt": "2025-10-20T10:10:41", "underlying": "META", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 65.19082000000003, "commission": -1.41459}, {"dt": "2025-10-20T10:41:24", "underlying": "IBIT", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 51.210820000000005, "commission": -1.39459}, {"dt": "2025-10-20T12:47:35", "underlying": "UPS", "strategy": "Short Put", "realized_pl": 53.18541, "commission": -1.0459}, {"dt": "2025-10-20T13:01:12", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 45.570820000000026, "commission": -3.03459}, {"dt": "2025-10-21T10:08:48", "underlying": "TGT", "strategy": "Short Call", "realized_pl": -26.74709, "commission": -0.6959}, {"dt": "2025-10-21T11:42:51", "underlying": "NCLH", "strategy": "Short Put", "realized_pl": 32.18541, "commission": -0.7659}, {"dt": "2025-10-21T12:02:51", "underlying": "NKE", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 45.210820000000005, "commission": -1.39459}, {"dt": "2025-10-22T13:25:40", "underlying": "AMD", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 57.19082000000003, "commission": -1.41459}, {"dt": "2025-10-23T12:52:22", "underlying": "TSLA", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 81.2108199999999, "commission": -1.39459}, {"dt": "2025-10-24T09:30:05", "underlying": "PYPL", "strategy": "Short Put", "realized_pl": 43.50541, "commission": -0.6959}, {"dt": "2025-10-24T11:20:54", "underlying": "BABA", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 58.510820000000024, "commission": -2.09459}, {"dt": "2025-10-27T09:31:34", "underlying": "TGT", "strategy": "Short Call", "realized_pl": -76.74709, "commission": -1.0484}, {"dt": "2025-10-27T09:33:05", "underlying": "AMZN", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 80.19082000000003, "commission": -1.39459}, {"dt": "2025-10-28T13:16:17", "underlying": "TGT", "strategy": "Short Call", "realized_pl": -233.74709, "commission": -0.6959}, {"dt": "2025-10-29T10:28:33", "underlying": "TGT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -84.80918, "commission": -1.41459}, {"dt": "2025-10-30T15:22:04", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -42.194179999999996, "commission": -2.09959}, {"dt": "2025-10-30T15:59:28", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 40.71082000000001, "commission": -1.39459}, {"dt": "2025-10-31T10:17:40", "underlying": "UPS", "strategy": "Short Put", "realized_pl": 24.90541, "commission": -1.0459}, {"dt": "2025-11-03T09:30:00", "underlying": "IAU", "strategy": "Short Put", "realized_pl": 49.90541, "commission": -0.0459}, {"dt": "2025-11-03T09:30:03", "underlying": "IAU", "strategy": "Short Put", "realized_pl": 40.00541, "commission": -0.0459}, {"dt": "2025-11-03T09:59:07", "underlying": "NKE", "strategy": "Long Put", "realized_pl": 58.53541, "commission": -0.76869}, {"dt": "2025-11-03T10:24:04", "underlying": "BABA", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 49.510819999999995, "commission": -1.39459}, {"dt": "2025-11-04T11:26:22", "underlying": "GM", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 37.210820000000005, "commission": -1.39459}, {"dt": "2025-11-04T13:12:43", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": -243.74709, "commission": -1.0484}, {"dt": "2025-11-05T12:49:29", "underlying": "KMI", "strategy": "Short Put", "realized_pl": 30.25541, "commission": -0.6959}, {"dt": "2025-11-06T10:50:27", "underlying": "TGT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 44.19081999999999, "commission": -1.39459}, {"dt": "2025-11-06T11:12:53", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 86.82582000000002, "commission": -2.09959}, {"dt": "2025-11-06T11:23:06", "underlying": "TGT", "strategy": "Short Call", "realized_pl": 442.25541, "commission": -1.0459}, {"dt": "2025-11-07T11:00:46", "underlying": "KR", "strategy": "Short Put", "realized_pl": 34.90541, "commission": -1.0459}, {"dt": "2025-11-07T11:24:04", "underlying": "GLD", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 14.190819999999974, "commission": -1.39459}, {"dt": "2025-11-07T11:42:53", "underlying": "CL", "strategy": "Short Put", "realized_pl": 45.95541, "commission": 0.0041}, {"dt": "2025-11-07T14:34:14", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": 98.25291, "commission": -0.6959}, {"dt": "2025-11-10T09:34:52", "underlying": "GLD", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 83.51081999999997, "commission": -2.09459}, {"dt": "2025-11-10T10:22:52", "underlying": "META", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": -53.789179999999995, "commission": -1.39459}, {"dt": "2025-11-11T09:38:47", "underlying": "IBIT", "strategy": "PDS (Bear Put Debit Spread)", "realized_pl": 80.86082, "commission": -1.39459}, {"dt": "2025-11-11T09:39:30", "underlying": "KHC", "strategy": "Short Put", "realized_pl": 31.25541, "commission": -0.6959}, {"dt": "2025-11-11T09:51:05", "underlying": "UPS", "strategy": "Short Put", "realized_pl": 28.90541, "commission": -1.0459}, {"dt": "2025-11-12T09:43:35", "underlying": "NKE", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 49.50582, "commission": -2.09959}, {"dt": "2025-11-12T09:53:41", "underlying": "CMG", "strategy": "Short Put", "realized_pl": -19.74459, "commission": -0.6959}, {"dt": "2025-11-12T11:43:08", "underlying": "CMG", "strategy": "Short Put", "realized_pl": 29.15541, "commission": -1.0459}, {"dt": "2025-11-13T09:43:08", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 14.210820000000012, "commission": -1.39459}, {"dt": "2025-11-13T15:58:36", "underlying": "IBIT", "strategy": "Long Put", "realized_pl": 21.25541, "commission": -1.04869}, {"dt": "2025-11-14T15:49:48", "underlying": "GM", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 1.2108199999999982, "commission": -1.39459}, {"dt": "2025-11-14T16:20:00", "underlying": "NCLH", "strategy": "Short Put", "realized_pl": 0.0, "commission": 0.0}, {"dt": "2025-11-17T09:30:11", "underlying": "GM", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 36.210820000000005, "commission": -1.39459}, {"dt": "2025-11-19T14:31:24", "underlying": "TGT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 77.21082000000001, "commission": -1.39459}, {"dt": "2025-11-20T10:11:20", "underlying": "RCL", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": -71.48917999999999, "commission": -1.39459}, {"dt": "2025-11-20T11:22:52", "underlying": "TGT", "strategy": "Short Call", "realized_pl": 230.90541, "commission": -1.0459}, {"dt": "2025-11-20T11:56:13", "underlying": "IBIT", "strategy": "Long Put", "realized_pl": 104.25541, "commission": -1.04869}, {"dt": "2025-11-21T13:49:55", "underlying": "RCL", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 60.21082000000001, "commission": -1.39459}, {"dt": "2025-11-21T15:06:14", "underlying": "NCLH", "strategy": "Short Put", "realized_pl": 27.90541, "commission": -1.0459}, {"dt": "2025-11-21T16:20:00", "underlying": "IAU", "strategy": "Covered Call", "realized_pl": 87.93251, "commission": -0.0166}, {"dt": "2025-11-21T16:20:00", "underlying": "BBWI", "strategy": "Multi-leg (2 legs)", "realized_pl": 0.0, "commission": 0.0}, {"dt": "2025-11-24T09:46:20", "underlying": "META", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": -87.78917999999999, "commission": -1.39459}, {"dt": "2025-11-24T12:12:34", "underlying": "NCLH", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 26.110820000000004, "commission": -2.49459}, {"dt": "2025-11-24T12:49:14", "underlying": "NKE", "strategy": "Short Put", "realized_pl": -43.39459, "commission": -0.6959}, {"dt": "2025-11-24T15:16:40", "underlying": "TGT", "strategy": "Short Call", "realized_pl": 74.25541, "commission": -1.0459}, {"dt": "2025-11-25T09:47:29", "underlying": "META", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 45.21082000000001, "commission": -1.39459}, {"dt": "2025-11-25T10:40:27", "underlying": "BBWI", "strategy": "Short Put", "realized_pl": 56.00541, "commission": 0.0041}, {"dt": "2025-11-26T09:57:52", "underlying": "BBWI", "strategy": "Short Call", "realized_pl": -71.29459, "commission": -0.2459}, {"dt": "2025-11-26T10:26:09", "underlying": "TGT", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 31.510819999999995, "commission": -2.09459}, {"dt": "2025-11-26T10:52:14", "underlying": "NKE", "strategy": "Short Put", "realized_pl": 70.25541, "commission": -1.0459}, {"dt": "2025-11-26T15:56:30", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": -170.39459, "commission": -0.6959}, {"dt": "2025-11-28T09:30:05", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": -216.23459, "commission": -1.5359}, {"dt": "2025-11-28T10:29:35", "underlying": "TGT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -20.49418, "commission": -2.09959}, {"dt": "2025-11-28T10:51:14", "underlying": "IBIT", "strategy": "Short Call", "realized_pl": -60.09709, "commission": -1.0484}, {"dt": "2025-12-01T09:30:36", "underlying": "IBIT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 27.574420000000003, "commission": -1.33099}, {"dt": "2025-12-01T09:43:27", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -219.72558000000004, "commission": -1.33099}, {"dt": "2025-12-01T10:34:04", "underlying": "IBIT", "strategy": "Short Call", "realized_pl": 115.93471, "commission": -1.0141}, {"dt": "2025-12-01T12:21:20", "underlying": "TGT", "strategy": "Short Call", "realized_pl": -150.36279, "commission": -0.6641}, {"dt": "2025-12-01T15:16:47", "underlying": "BBWI", "strategy": "Short Call", "realized_pl": -119.26279, "commission": -0.2141}, {"dt": "2025-12-02T10:12:22", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": 122.96901, "commission": -1.0141}, {"dt": "2025-12-03T09:41:26", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": -308.06279, "commission": -1.0141}, {"dt": "2025-12-03T09:42:40", "underlying": "IBIT", "strategy": "Long Call", "realized_pl": 71.31901, "commission": -1.01689}, {"dt": "2025-12-03T09:53:38", "underlying": "GOOG", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 61.274419999999964, "commission": -1.33099}, {"dt": "2025-12-04T09:31:33", "underlying": "CRM", "strategy": "Multi-leg (3 legs)", "realized_pl": 99.94952999999998, "commission": -3.05259}, {"dt": "2025-12-05T09:33:46", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": 86.28471, "commission": -1.0166}, {"dt": "2025-12-05T11:07:33", "underlying": "IBIT", "strategy": "Short Call", "realized_pl": 5.80901, "commission": -0.5241}, {"dt": "2025-12-05T11:32:22", "underlying": "KR", "strategy": "Short Put", "realized_pl": 31.46901, "commission": -0.7641}, {"dt": "2025-12-09T09:34:10", "underlying": "META", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -204.7455799999998, "commission": -1.33099}, {"dt": "2025-12-09T09:42:12", "underlying": "NKE", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 20.274419999999992, "commission": -1.33099}, {"dt": "2025-12-09T09:48:22", "underlying": "META", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 53.338019999999915, "commission": -1.33099}, {"dt": "2025-12-09T11:41:06", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": 72.96901, "commission": -1.0141}, {"dt": "2025-12-10T10:01:43", "underlying": "KO", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 35.33802, "commission": -1.33099}, {"dt": "2025-12-10T12:50:15", "underlying": "PG", "strategy": "Short Put", "realized_pl": 34.21901, "commission": -1.0141}, {"dt": "2025-12-10T13:22:46", "underlying": "META", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 2.2744199999999637, "commission": -1.33099}, {"dt": "2025-12-10T14:51:12", "underlying": "SPXW", "strategy": "Iron Condor", "realized_pl": 16.747199999999907, "commission": -6.4264}, {"dt": "2025-12-11T09:56:21", "underlying": "IBIT", "strategy": "Short Call", "realized_pl": 86.45901, "commission": -1.0141}, {"dt": "2025-12-11T15:41:24", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": 81.96651, "commission": -1.0141}, {"dt": "2025-12-12T09:35:13", "underlying": "LULU", "strategy": "Short Put", "realized_pl": 55.48901, "commission": -1.4941}, {"dt": "2025-12-12T09:35:48", "underlying": "LULU", "strategy": "Multi-leg (3 legs)", "realized_pl": 99.00702999999999, "commission": -1.99509}, {"dt": "2025-12-12T09:38:33", "underlying": "KR", "strategy": "Short Put", "realized_pl": 19.96901, "commission": -1.0141}, {"dt": "2025-12-12T10:35:46", "underlying": "BBWI", "strategy": "Short Put", "realized_pl": 34.76901, "commission": -0.2141}, {"dt": "2025-12-12T15:59:13", "underlying": "SPY", "strategy": "Short Put", "realized_pl": 183.50901, "commission": -0.8241}, {"dt": "2025-12-12T16:02:24", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": -62.361979999999996, "commission": -1.33099}, {"dt": "2025-12-12T16:20:00", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": 0.0, "commission": 0.0}, {"dt": "2025-12-12T16:20:00", "underlying": "SPY", "strategy": "Long Put", "realized_pl": -146.6641, "commission": 0.0}, {"dt": "2025-12-15T09:46:00", "underlying": "IBIT", "strategy": "Short Call", "realized_pl": 48.96901, "commission": -1.0141}, {"dt": "2025-12-15T09:46:08", "underlying": "IBIT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 44.33802, "commission": -1.33099}, {"dt": "2025-12-15T12:42:34", "underlying": "META", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 4.33802, "commission": -1.33099}, {"dt": "2025-12-15T12:42:38", "underlying": "META", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 39.33802000000003, "commission": -1.33099}, {"dt": "2025-12-15T15:38:36", "underlying": "NFLX", "strategy": "Short Call", "realized_pl": 60.96901, "commission": -1.0141}, {"dt": "2025-12-16T10:14:44", "underlying": "NCLH", "strategy": "Long Put", "realized_pl": -57.03099, "commission": -1.01689}, {"dt": "2025-12-17T09:35:12", "underlying": "TGT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 21.33802, "commission": -1.33099}, {"dt": "2025-12-17T15:59:18", "underlying": "GM", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -95.66198000000001, "commission": -1.33099}, {"dt": "2025-12-18T10:26:19", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 24.638019999999983, "commission": -1.33099}, {"dt": "2025-12-18T10:35:01", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 59.371039999999994, "commission": -1.2619799999999999}, {"dt": "2025-12-18T10:36:41", "underlying": "TGT", "strategy": "Short Call", "realized_pl": -563.43099, "commission": -0.7641}, {"dt": "2025-12-18T10:37:07", "underlying": "TGT", "strategy": "Stock", "realized_pl": 512.92916, "commission": -1.0166}, {"dt": "2025-12-18T10:37:20", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 49.55802000000003, "commission": -2.43099}, {"dt": "2025-12-18T12:13:52", "underlying": "NFLX", "strategy": "Short Call", "realized_pl": 58.96901, "commission": -1.0141}, {"dt": "2025-12-18T12:45:11", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 36.33801999999997, "commission": -1.33099}, {"dt": "2025-12-18T14:16:37", "underlying": "IBIT", "strategy": "Short Call", "realized_pl": 31.45901, "commission": -0.5241}, {"dt": "2025-12-18T15:35:01", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 36.958020000000005, "commission": -2.03099}, {"dt": "2025-12-19T09:41:01", "underlying": "ORCL", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 16.63802000000001, "commission": -2.03099}, {"dt": "2025-12-19T09:48:05", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": -60.68099, "commission": -0.6641}, {"dt": "2025-12-19T09:57:47", "underlying": "TGT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 35.33802, "commission": -1.33099}, {"dt": "2025-12-19T11:31:46", "underlying": "NCLH", "strategy": "Long Call", "realized_pl": 147.31901, "commission": -1.01689}, {"dt": "2025-12-19T12:09:16", "underlying": "NCLH", "strategy": "Short Call", "realized_pl": -248.68099, "commission": -1.0141}, {"dt": "2025-12-19T12:26:00", "underlying": "ORCL", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 63.63801999999998, "commission": -2.03099}, {"dt": "2025-12-19T16:20:00", "underlying": "NCLH", "strategy": "Covered Call", "realized_pl": -5.86398, "commission": -0.0166}, {"dt": "2025-12-19T16:20:00", "underlying": "MARA", "strategy": "Short Put", "realized_pl": 0.0, "commission": 0.0}, {"dt": "2025-12-22T09:51:18", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 105.63801999999998, "commission": -2.03099}, {"dt": "2025-12-22T09:52:03", "underlying": "PYPL", "strategy": "Short Put", "realized_pl": 28.96901, "commission": -1.0141}, {"dt": "2025-12-22T10:15:31", "underlying": "NFLX", "strategy": "Short Call", "realized_pl": 50.96901, "commission": -1.0141}, {"dt": "2025-12-22T10:16:27", "underlying": "NCLH", "strategy": "Long Put", "realized_pl": -51.03099, "commission": -1.01689}, {"dt": "2025-12-22T10:32:43", "underlying": "BBWI", "strategy": "Short Call", "realized_pl": 38.56901, "commission": -0.2141}, {"dt": "2025-12-22T12:46:24", "underlying": "BBWI", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -15.92558, "commission": -0.43099}, {"dt": "2025-12-22T14:02:44", "underlying": "NCLH", "strategy": "Long Call", "realized_pl": 136.31901, "commission": -1.01689}, {"dt": "2025-12-23T09:35:22", "underlying": "NCLH", "strategy": "Short Call", "realized_pl": -167.68099, "commission": -1.0141}, {"dt": "2025-12-23T09:37:08", "underlying": "GOOGL", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 57.33802000000003, "commission": -1.33099}, {"dt": "2025-12-23T09:46:36", "underlying": "IBIT", "strategy": "Short Call", "realized_pl": 45.45901, "commission": -1.0141}, {"dt": "2025-12-23T10:06:40", "underlying": "TGT", "strategy": "Short Put", "realized_pl": -86.03099, "commission": -1.0141}, {"dt": "2025-12-23T12:12:19", "underlying": "NCLH", "strategy": "Long Put", "realized_pl": 35.96901, "commission": -1.01689}, {"dt": "2025-12-23T13:20:29", "underlying": "XLE", "strategy": "Short Put", "realized_pl": 29.96901, "commission": -1.0141}, {"dt": "2025-12-24T09:38:38", "underlying": "NKE", "strategy": "Short Put", "realized_pl": 33.21901, "commission": -1.0141}, {"dt": "2025-12-26T09:59:18", "underlying": "TGT", "strategy": "Short Put", "realized_pl": 127.96901, "commission": -1.0141}, {"dt": "2025-12-26T12:04:10", "underlying": "MARA", "strategy": "Short Call", "realized_pl": 28.38901, "commission": -1.0141}, {"dt": "2025-12-26T16:20:00", "underlying": "XLE", "strategy": "Short Put", "realized_pl": 0.0, "commission": 0.0}, {"dt": "2025-12-29T12:09:42", "underlying": "XLE", "strategy": "Short Call", "realized_pl": -17.68349, "commission": -1.0166}, {"dt": "2025-12-30T09:34:51", "underlying": "GM", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -21.366979999999998, "commission": -2.03599}, {"dt": "2025-12-30T09:42:45", "underlying": "KHC", "strategy": "Short Put", "realized_pl": 36.63802, "commission": -1.3282}, {"dt": "2025-12-30T09:52:42", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": 79.66901, "commission": -0.6641}, {"dt": "2025-12-30T09:59:12", "underlying": "UBER", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 34.613020000000006, "commission": -2.03599}, {"dt": "2025-12-30T12:06:32", "underlying": "XP", "strategy": "Short Put", "realized_pl": 45.76901, "commission": -0.0141}, {"dt": "2025-12-30T15:22:21", "underlying": "NFLX", "strategy": "Short Call", "realized_pl": 41.96901, "commission": -1.0141}, {"dt": "2026-01-02T09:37:24", "underlying": "GM", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 52.86322, "commission": -2.10079}, {"dt": "2026-01-02T09:43:29", "underlying": "IBIT", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 29.56822000000001, "commission": -2.10079}, {"dt": "2026-01-02T10:32:15", "underlying": "MARA", "strategy": "Short Put", "realized_pl": 8.35436, "commission": -0.62875}, {"dt": "2026-01-02T11:35:35", "underlying": "IBIT", "strategy": "Short Call", "realized_pl": -34.06564, "commission": -1.04875}, {"dt": "2026-01-02T12:15:29", "underlying": "IBIT", "strategy": "Short Put", "realized_pl": 66.28436, "commission": -1.04875}, {"dt": "2026-01-02T14:13:58", "underlying": "MARA", "strategy": "Short Put", "realized_pl": 8.35436, "commission": -1.04875}, {"dt": "2026-01-05T09:33:06", "underlying": "MARA", "strategy": "Short Call", "realized_pl": -22.06564, "commission": -1.04875}, {"dt": "2026-01-05T09:43:00", "underlying": "NFLX", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 6.2682199999999995, "commission": -1.40079}, {"dt": "2026-01-05T09:44:29", "underlying": "SPY", "strategy": "BCS (Bull Call Debit Spread)", "realized_pl": -9.136780000000002, "commission": -2.10579}, {"dt": "2026-01-05T09:45:01", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 33.88821999999999, "commission": -3.0807900000000004}, {"dt": "2026-01-05T14:27:36", "underlying": "PYPL", "strategy": "Short Put", "realized_pl": 31.89921, "commission": -1.04875}, {"dt": "2026-01-06T09:33:21", "underlying": "NFLX", "strategy": "Short Call", "realized_pl": 45.31921, "commission": -0.62875}, {"dt": "2026-01-06T10:44:16", "underlying": "BBWI", "strategy": "Long Call", "realized_pl": -9.21614, "commission": -0.00204}, {"dt": "2026-01-06T11:24:50", "underlying": "BBWI", "strategy": "Short Put", "realized_pl": 22.94921, "commission": 0.00125}, {"dt": "2026-01-07T09:41:18", "underlying": "SPY", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 40.16822000000002, "commission": -2.5007900000000003}, {"dt": "2026-01-07T15:26:37", "underlying": "RIVN", "strategy": "Short Put", "realized_pl": 24.93436, "commission": -1.04875}, {"dt": "2026-01-08T10:54:32", "underlying": "RBLX", "strategy": "Long Put", "realized_pl": 62.49921, "commission": -0.80204}, {"dt": "2026-01-08T11:27:52", "underlying": "KO", "strategy": "Short Put", "realized_pl": 24.89921, "commission": -1.04875}, {"dt": "2026-01-08T11:34:15", "underlying": "RIVN", "strategy": "Short Put", "realized_pl": 28.46436, "commission": -0.79875}, {"dt": "2026-01-08T14:51:52", "underlying": "KO", "strategy": "Iron Condor", "realized_pl": 37.31684000000001, "commission": -2.8415800000000004}, {"dt": "2026-01-09T09:49:02", "underlying": "IBIT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 39.49842000000001, "commission": -2.10079}, {"dt": "2026-01-09T12:17:12", "underlying": "PG", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 52.25842, "commission": -2.34079}, {"dt": "2026-01-09T14:22:47", "underlying": "IBIT", "strategy": "Short Call", "realized_pl": 75.89921, "commission": -1.04875}, {"dt": "2026-01-12T09:31:05", "underlying": "KR", "strategy": "Short Put", "realized_pl": -44.75079, "commission": -0.69875}, {"dt": "2026-01-12T09:34:19", "underlying": "TGT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -89.73178000000001, "commission": -1.40079}, {"dt": "2026-01-12T09:34:20", "underlying": "TGT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 65.19842, "commission": -1.40079}, {"dt": "2026-01-12T09:35:29", "underlying": "BBWI", "strategy": "Short Call", "realized_pl": -164.26564, "commission": -0.04875}, {"dt": "2026-01-12T15:51:39", "underlying": "RBLX", "strategy": "Short Put", "realized_pl": 96.24921, "commission": -1.04875}, {"dt": "2026-01-13T09:35:02", "underlying": "NFLX", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 3.1984199999999987, "commission": -1.40079}, {"dt": "2026-01-13T09:35:04", "underlying": "MARA", "strategy": "Short Put", "realized_pl": 33.89921, "commission": -1.04875}, {"dt": "2026-01-13T13:06:56", "underlying": "NCLH", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 36.871840000000006, "commission": -1.62158}, {"dt": "2026-01-13T15:50:14", "underlying": "KR", "strategy": "Short Put", "realized_pl": 62.24921, "commission": -1.04875}, {"dt": "2026-01-14T10:47:18", "underlying": "SPY", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 32.99842000000001, "commission": -2.10079}, {"dt": "2026-01-14T10:50:30", "underlying": "NFLX", "strategy": "Short Call", "realized_pl": 42.89921, "commission": -1.04875}, {"dt": "2026-01-14T11:10:04", "underlying": "IBIT", "strategy": "Long Call", "realized_pl": 42.59921, "commission": -0.70204}, {"dt": "2026-01-14T11:29:54", "underlying": "KHC", "strategy": "Short Put", "realized_pl": 31.89921, "commission": -1.04875}, {"dt": "2026-01-14T11:55:12", "underlying": "JPM", "strategy": "Short Put", "realized_pl": -293.34079, "commission": -0.69875}, {"dt": "2026-01-14T13:15:44", "underlying": "JPM", "strategy": "Multi-leg (5 legs)", "realized_pl": 307.41526, "commission": -3.5623700000000005}, {"dt": "2026-01-15T09:31:47", "underlying": "GS", "strategy": "Iron Condor", "realized_pl": 48.596840000000014, "commission": -4.20158}, {"dt": "2026-01-15T09:44:23", "underlying": "NVS", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -45.18158, "commission": -0.50079}, {"dt": "2026-01-15T09:46:25", "underlying": "MARA", "strategy": "Short Call", "realized_pl": -8.10079, "commission": -1.04875}, {"dt": "2026-01-15T10:01:28", "underlying": "BBWI", "strategy": "Short Call", "realized_pl": -145.06564, "commission": -0.04875}, {"dt": "2026-01-16T10:35:36", "underlying": "IBIT", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": -29.501580000000004, "commission": -2.10079}, {"dt": "2026-01-16T10:46:30", "underlying": "INTC", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 22.17841999999999, "commission": -1.42079}, {"dt": "2026-01-16T11:45:06", "underlying": "JPM", "strategy": "PCS (Bull Put Credit Spread)", "realized_pl": 3.1984199999999987, "commission": -1.40079}, {"dt": "2026-01-16T11:56:58", "underlying": "INTC", "strategy": "CCS (Bear Call Credit Spread)", "realized_pl": 22.49842000000001, "commission": -1.40079}, {"dt": "2026-01-16T16:20:00", "underlying": "BBWI", "strategy": "Covered Call", "realized_pl": -275.26688, "commission": -0.0195}, {"dt": "2026-01-16T16:20:00", "underlying": "PYPL", "strategy": "Covered Call", "realized_pl": 83.21361, "commission": -0.0195}, {"dt": "2026-01-16T16:20:00", "underlying": "XLE", "strategy": "Covered Call", "realized_pl": 149.94422, "commission": -0.0195}, {"dt": "2026-01-16T16:20:00", "underlying": "XLU", "strategy": "Short Put", "realized_pl": 35.94796, "commission": 0.0}];
  const OPEN_POS = [{"underlying": "BBWI", "symbol": "BBWI", "unrealized_pl": -147.04738}, {"underlying": "IBIT", "symbol": "IBIT", "unrealized_pl": -179.01689}, {"underlying": "MARA", "symbol": "MARA", "unrealized_pl": -161.66689}, {"underlying": "PYPL", "symbol": "PYPL", "unrealized_pl": -103.0}, {"underlying": "XLE", "symbol": "XLE", "unrealized_pl": 62.98311}, {"underlying": "BBWI", "symbol": "BBWI 16JAN26 17.5 C", "unrealized_pl": -141.13869}, {"underlying": "BBWI", "symbol": "BBWI 16JAN26 20 C", "unrealized_pl": 40.74311}, {"underlying": "BBWI", "symbol": "BBWI 16JAN26 20.5 C", "unrealized_pl": 2.48311}, {"underlying": "BBWI", "symbol": "BBWI 16JAN26 22.5 C", "unrealized_pl": -23.7141}, {"underlying": "GM", "symbol": "GM 30JAN26 84 C", "unrealized_pl": 91.14061}, {"underlying": "GM", "symbol": "GM 30JAN26 87 C", "unrealized_pl": -57.9066}, {"underlying": "IBIT", "symbol": "IBIT 09JAN26 52 C", "unrealized_pl": 20.48311}, {"underlying": "IBIT", "symbol": "IBIT 16JAN26 45 P", "unrealized_pl": -79.6641}, {"underlying": "IBIT", "symbol": "IBIT 16JAN26 47 P", "unrealized_pl": 100.33311}, {"underlying": "IBIT", "symbol": "IBIT 16JAN26 51 P", "unrealized_pl": -31.63689}, {"underlying": "MARA", "symbol": "MARA 09JAN26 10 P", "unrealized_pl": -57.10689}, {"underlying": "MARA", "symbol": "MARA 16JAN26 9.5 P", "unrealized_pl": -20.81689}, {"underlying": "MARA", "symbol": "MARA 16JAN26 10.5 C", "unrealized_pl": 16.48311}, {"underlying": "NFLX", "symbol": "NFLX 16JAN26 86 P", "unrealized_pl": -96.6441}, {"underlying": "NFLX", "symbol": "NFLX 16JAN26 91 P", "unrealized_pl": 142.02311}, {"underlying": "NFLX", "symbol": "NFLX 15JAN27 60 C", "unrealized_pl": -18.1241}, {"underlying": "PYPL", "symbol": "PYPL 16JAN26 55 C", "unrealized_pl": 139.52311}, {"underlying": "RIVN", "symbol": "RIVN 16JAN26 18 P", "unrealized_pl": 7.26311}, {"underlying": "RIVN", "symbol": "RIVN 16JAN26 19 P", "unrealized_pl": -6.51689}, {"underlying": "SPY", "symbol": "SPY 06JAN26 683 P", "unrealized_pl": 105.5959}, {"underlying": "SPY", "symbol": "SPY 06JAN26 685 P", "unrealized_pl": -139.17689}, {"underlying": "SPY", "symbol": "SPY 09JAN26 687 C", "unrealized_pl": -281.5141}, {"underlying": "SPY", "symbol": "SPY 09JAN26 690 C", "unrealized_pl": 218.98311}, {"underlying": "SPY", "symbol": "SPY 16JAN26 680 P", "unrealized_pl": -3.1641}, {"underlying": "SPY", "symbol": "SPY 16JAN26 682 P", "unrealized_pl": -0.16689}, {"underlying": "TGT", "symbol": "TGT 16JAN26 102 C", "unrealized_pl": 33.83311}, {"underlying": "TGT", "symbol": "TGT 16JAN26 105 C", "unrealized_pl": -21.5441}, {"underlying": "XLE", "symbol": "XLE 16JAN26 45 C", "unrealized_pl": 2.48061}, {"underlying": "BBWI", "symbol": "BBWI", "unrealized_pl": 322.95131}, {"underlying": "IBIT", "symbol": "IBIT", "unrealized_pl": 279.98311}, {"underlying": "MARA", "symbol": "MARA", "unrealized_pl": 76.33311}, {"underlying": "ADBE", "symbol": "ADBE 20FEB26 285 P", "unrealized_pl": 156.80125}, {"underlying": "ADBE", "symbol": "ADBE 20FEB26 290 P", "unrealized_pl": -190.70204}, {"underlying": "ADBE", "symbol": "ADBE 20FEB26 295 P", "unrealized_pl": 452.30125}, {"underlying": "ADBE", "symbol": "ADBE 20FEB26 300 P", "unrealized_pl": -554.41204}, {"underlying": "BBWI", "symbol": "BBWI 30JAN26 22 C", "unrealized_pl": -2.59204}, {"underlying": "BBWI", "symbol": "BBWI 06FEB26 23 C", "unrealized_pl": 20.21796}, {"underlying": "BBWI", "symbol": "BBWI 06FEB26 25 C", "unrealized_pl": -23.24875}, {"underlying": "BBWI", "symbol": "BBWI 20FEB26 22.5 C", "unrealized_pl": -13.81204}, {"underlying": "BBWI", "symbol": "BBWI 20FEB26 25 C", "unrealized_pl": -7.54875}, {"underlying": "CRM", "symbol": "CRM 20FEB26 210 P", "unrealized_pl": 66.80125}, {"underlying": "CRM", "symbol": "CRM 20FEB26 220 P", "unrealized_pl": -99.20204}, {"underlying": "DIA", "symbol": "DIA 20FEB26 480 P", "unrealized_pl": -191.04875}, {"underlying": "DIA", "symbol": "DIA 20FEB26 485 P", "unrealized_pl": 228.94796}, {"underlying": "DIA", "symbol": "DIA 20FEB26 515 C", "unrealized_pl": -10.05204}, {"underlying": "DIA", "symbol": "DIA 20FEB26 520 C", "unrealized_pl": -0.54875}, {"underlying": "IBIT", "symbol": "IBIT 23JAN26 52 C", "unrealized_pl": -131.92204}, {"underlying": "IBIT", "symbol": "IBIT 06FEB26 54.5 C", "unrealized_pl": -32.05204}, {"underlying": "IBIT", "symbol": "IBIT 06FEB26 60 C", "unrealized_pl": 3.95125}, {"underlying": "JPM", "symbol": "JPM 20FEB26 300 P", "unrealized_pl": -200.19875}, {"underlying": "JPM", "symbol": "JPM 20FEB26 305 P", "unrealized_pl": 246.29796}, {"underlying": "KHC", "symbol": "KHC 30JAN26 23.5 P", "unrealized_pl": -3.26204}, {"underlying": "MARA", "symbol": "MARA 23JAN26 10.5 C", "unrealized_pl": -69.60204}, {"underlying": "MARA", "symbol": "MARA 06FEB26 11 C", "unrealized_pl": -22.05204}, {"underlying": "MARA", "symbol": "MARA 20FEB26 12 C", "unrealized_pl": 3.79796}, {"underlying": "MARA", "symbol": "MARA 20FEB26 15 C", "unrealized_pl": -3.69875}, {"underlying": "NCLH", "symbol": "NCLH 20FEB26 20 P", "unrealized_pl": 3.80125}, {"underlying": "NCLH", "symbol": "NCLH 20FEB26 22 P", "unrealized_pl": -5.70204}, {"underlying": "NFLX", "symbol": "NFLX 15JAN27 60 C", "unrealized_pl": -565.0741}, {"underlying": "NVS", "symbol": "NVS 20FEB26 145 C", "unrealized_pl": 39.74796}, {"underlying": "NVS", "symbol": "NVS 20FEB26 150 C", "unrealized_pl": -38.90875}, {"underlying": "PYPL", "symbol": "PYPL 30JAN26 55 P", "unrealized_pl": 20.79796}, {"underlying": "RIVN", "symbol": "RIVN 30JAN26 16.5 P", "unrealized_pl": -15.55204}, {"underlying": "T", "symbol": "T 30JAN26 23 P", "unrealized_pl": 2.44796}, {"underlying": "T", "symbol": "T 30JAN26 23.5 P", "unrealized_pl": 4.44796}, {"underlying": "TGT", "symbol": "TGT 06FEB26 106 C", "unrealized_pl": -431.35204}, {"underlying": "TGT", "symbol": "TGT 06FEB26 110 C", "unrealized_pl": 296.78125}, {"underlying": "TGT", "symbol": "TGT 06FEB26 112 C", "unrealized_pl": -38.24204}, {"underlying": "TGT", "symbol": "TGT 06FEB26 115 C", "unrealized_pl": 8.95125}, {"underlying": "XLE", "symbol": "XLE 20FEB26 49 C", "unrealized_pl": -19.70204}, {"underlying": "XLE", "symbol": "XLE 20FEB26 52.5 C", "unrealized_pl": 5.06125}];

  const errBox = document.getElementById('err');
  function showErr(msg){
    errBox.style.display = 'block';
    errBox.textContent = msg;
  }

  window.addEventListener('error', (e) => {
    showErr("Error JS: " + (e && e.message ? e.message : "desconocido") + ". Abre la consola (F12) para ms detalle.");
  });

  if (!window.Plotly){
    showErr("No se pudo cargar Plotly desde el CDN. Revisa tu internet o bloqueos de red (firewall).");
  }

  function getSelected(id) {
    const el = document.getElementById(id);
    return Array.from(el.selectedOptions).map(o => o.value);
  }

  const fmtUSD = new Intl.NumberFormat('en-US', { style:'currency', currency:'USD', maximumFractionDigits: 0 });
  function money(x) { return fmtUSD.format(x || 0); }
  function pct(x) { return ((x||0)*100).toFixed(1) + "%"; }

  function computeMaxDrawdown(ys){
    let peak = -Infinity;
    let dd = 0;
    for (const y of ys){
      if (y > peak) peak = y;
      dd = Math.min(dd, y - peak);
    }
    return dd;
  }

  function filterTrades(){
    const stratSel = getSelected('strategy');
    const undSel = getSelected('underlying');
    const strategies = new Set(stratSel);
    const underlyings = new Set(undSel);
    const start = document.getElementById('start').value;
    const end = document.getElementById('end').value;

    return TRADES.filter(t => {
      const d = t.dt.slice(0,10);
      const okStrat = (strategies.size === 0) || strategies.has(t.strategy);
      const okUnd = (underlyings.size === 0) || underlyings.has(t.underlying);
      return okStrat && okUnd && d >= start && d <= end;
    }).sort((a,b) => a.dt.localeCompare(b.dt));
  }

  function computeStats(rows) {
    const n = rows.length;
    const pl = rows.reduce((s,r)=>s + (r.realized_pl||0), 0);
    const wins = rows.filter(r => (r.realized_pl||0) > 0);
    const losses = rows.filter(r => (r.realized_pl||0) < 0);

    const wr = n ? wins.length / n : 0;

    const gp = wins.reduce((s,r)=>s + r.realized_pl, 0);
    const gl = losses.reduce((s,r)=>s + Math.abs(r.realized_pl), 0);
    const pf = gl ? gp / gl : (gp>0 ? Infinity : 0);

    const avg = n ? pl / n : 0;
    const avgWin = wins.length ? (gp / wins.length) : 0;
    const avgLoss = losses.length ? (losses.reduce((s,r)=>s + r.realized_pl, 0) / losses.length) : 0; // negativo

    const dayMap = new Map();
    for (const r of rows) {
      const d = (r.dt || '').slice(0,10);
      if (!d) continue;
      dayMap.set(d, (dayMap.get(d)||0) + (r.realized_pl||0));
    }
    const xs = Array.from(dayMap.keys()).sort();
    let cum = 0;
    const daily = [];
    const ys = [];
    for (const d of xs) {
      const v = dayMap.get(d) || 0;
      daily.push(v);
      cum += v;
      ys.push(cum);
    }
    const dd = computeMaxDrawdown(ys);

    return { n, pl, wr, pf, avg, avgWin, avgLoss, xs, ys, daily, dd };
  }

  function groupSum(rows, key) {
    const m = new Map();
    for (const r of rows) {
      const k = r[key];
      m.set(k, (m.get(k)||0) + r.realized_pl);
    }
    return Array.from(m.entries()).map(([k,v])=>({k, v})).sort((a,b)=>b.v-a.v);
  }

  function groupCount(rows, key){
    const m = new Map();
    for (const r of rows){
      const k=r[key];
      m.set(k,(m.get(k)||0)+1);
    }
    return Array.from(m.entries()).map(([k,v])=>({k, v})).sort((a,b)=>b.v-a.v);
  }

  function unrealizedForSelectedUnderlyings(){
    const underlyings = new Set(getSelected('underlying'));
    return OPEN_POS.filter(p => underlyings.has(p.underlying)).reduce((s,p)=>s + (p.unrealized_pl||0), 0);
  }

  function render(){
    if (!window.Plotly) return;

    const rows = filterTrades();
    const st = computeStats(rows);

    document.getElementById('k_pl').innerText = money(st.pl);
    document.getElementById('k_upl').innerText = money(unrealizedForSelectedUnderlyings());
    document.getElementById('k_wr').innerText = pct(st.wr);
    document.getElementById('k_n').innerText = st.n.toString();
    document.getElementById('k_pf').innerText = (st.pf === Infinity ? '' : st.pf.toFixed(2));
    document.getElementById('k_avg').innerText = money(st.avg);
    document.getElementById('k_avg_win').innerText = money(st.avgWin);
    document.getElementById('k_avg_loss').innerText = money(st.avgLoss);

    // Equity daily + cumulative
    Plotly.react('equity', [
      {x: st.xs, y: st.daily, type:'bar', name:'Daily P/L', opacity:0.35, hovertemplate:'%{x}<br>Daily P/L: %{y:,.0f}<extra></extra>'},
      {x: st.xs, y: st.ys, type:'scatter', mode:'lines', name:'Cum P/L', hovertemplate:'%{x}<br>Cum P/L: %{y:,.0f}<extra></extra>'}
    ], {
      title: 'P/L realizado: diario + acumulado',
      margin: {l:50,r:20,t:40,b:50},
      paper_bgcolor:'rgba(0,0,0,0)',
      plot_bgcolor:'rgba(0,0,0,0)',
      barmode:'overlay',
      legend:{orientation:'h'},
      xaxis:{title:'Da'},
      yaxis:{title:'USD', tickformat:',.0f'}
    }, {displayModeBar:false, responsive:true});

    // Distribution
    Plotly.react('dist', [
      {x: rows.map(r=>r.realized_pl), type:'histogram', nbinsx: 40, name:'P/L'}
    ], {
      title: 'Distribucin de P/L por trade',
      margin: {l:50,r:20,t:40,b:50},
      paper_bgcolor:'rgba(0,0,0,0)',
      plot_bgcolor:'rgba(0,0,0,0)',
      xaxis:{title:'P/L (USD)', tickformat:',.0f'},
      yaxis:{title:'# trades'}
    }, {displayModeBar:false, responsive:true});

    // By strategy
    const strat = groupSum(rows, 'strategy').slice(0, 20);
    Plotly.react('byStrategy', [
      {x: strat.map(d=>d.v), y: strat.map(d=>d.k), type:'bar', orientation:'h', hovertemplate:'%{y}<br>P/L: %{x:,.0f}<extra></extra>'}
    ], {
      title: 'P/L por estrategia (top 20)',
      margin: {l:190,r:20,t:40,b:40},
      paper_bgcolor:'rgba(0,0,0,0)',
      plot_bgcolor:'rgba(0,0,0,0)',
      xaxis:{tickformat:',.0f'}
    }, {displayModeBar:false, responsive:true});

    // By underlying
    const und = groupSum(rows, 'underlying').slice(0, 20);
    Plotly.react('byUnderlying', [
      {x: und.map(d=>d.v), y: und.map(d=>d.k), type:'bar', orientation:'h', hovertemplate:'%{y}<br>P/L: %{x:,.0f}<extra></extra>'}
    ], {
      title: 'P/L por activo (top 20)',
      margin: {l:120,r:20,t:40,b:40},
      paper_bgcolor:'rgba(0,0,0,0)',
      plot_bgcolor:'rgba(0,0,0,0)',
      xaxis:{tickformat:',.0f'}
    }, {displayModeBar:false, responsive:true});

    // Pie (Top 5 by count)
    const stratCount = groupCount(rows, 'strategy');
    const top5 = stratCount.slice(0,5);
    Plotly.react('pieStrategy', [{
      labels: top5.map(d=>d.k),
      values: top5.map(d=>d.v),
      type:'pie',
      textinfo:'label+percent',
      hovertemplate: '%{label}<br>Trades: %{value}<br>%{percent}<extra></extra>'
    }], {
      title: 'Peso % por estrategia (Top 5, count)',
      margin: {l:20,r:20,t:50,b:20},
      paper_bgcolor:'rgba(0,0,0,0)',
      plot_bgcolor:'rgba(0,0,0,0)'
    }, {displayModeBar:false, responsive:true});

    // Bind pie interactions AFTER the plot exists (Plotly adds .on after render)
    const gdPie = document.getElementById('pieStrategy');
    if (gdPie && gdPie.on && !gdPie.__boundClick) {
      gdPie.__boundClick = true;

      gdPie.on('plotly_click', (data) => {
        if (!data || !data.points || !data.points.length) return;
        const strat = data.points[0].label;
        const ev = data.event || {};
        const additive = !!(ev.ctrlKey || ev.metaKey || ev.shiftKey);

        const sel = document.getElementById('strategy');
        const opts = Array.from(sel.options);

        if (additive) {
          const target = opts.find(o => o.value === strat);
          if (target) target.selected = !target.selected;
          if (sel.selectedOptions.length === 0) {
            opts.forEach(o => o.selected = true);
          }
        } else {
          opts.forEach(o => o.selected = (o.value === strat));
        }
        render();
      });

      gdPie.on('plotly_doubleclick', () => {
        const sel = document.getElementById('strategy');
        Array.from(sel.options).forEach(o => o.selected = true);
        render();
      });
    }


    // Monthly bar (realized P/L)
    const monthMap = new Map();
    for (const r of rows){
      const m = r.dt.slice(0,7);
      monthMap.set(m, (monthMap.get(m)||0) + (r.realized_pl||0));
    }
    const months = Array.from(monthMap.keys()).sort();
    const vals = months.map(m => monthMap.get(m));
    Plotly.react('monthlyPL', [
      {x: months, y: vals, type:'bar', name:'Monthly Realized P/L', hovertemplate:'%{x}<br>Monthly P/L: %{y:,.0f}<extra></extra>'}
    ], {
      title: 'P/L Realizado por mes',
      margin: {l:50,r:20,t:40,b:60},
      paper_bgcolor:'rgba(0,0,0,0)',
      plot_bgcolor:'rgba(0,0,0,0)',
      xaxis:{title:'Mes'},
      yaxis:{title:'USD', tickformat:',.0f'}
    }, {displayModeBar:false, responsive:true});

    // Yearly bar (realized P/L)
    const yearMap = new Map();
    for (const r of rows){
      const y = r.dt.slice(0,4);
      yearMap.set(y, (yearMap.get(y)||0) + (r.realized_pl||0));
    }
    const years = Array.from(yearMap.keys()).sort();
    const yvals = years.map(y => yearMap.get(y));
    Plotly.react('yearlyPL', [
      {x: years, y: yvals, type:'bar', name:'Yearly Realized P/L', hovertemplate:'%{x}<br>Yearly P/L: %{y:,.0f}<extra></extra>'}
    ], {
      title: 'P/L Realizado por ao',
      margin: {l:50,r:20,t:40,b:60},
      paper_bgcolor:'rgba(0,0,0,0)',
      plot_bgcolor:'rgba(0,0,0,0)',
      xaxis:{title:'Ao'},
      yaxis:{title:'USD', tickformat:',.0f'}
    }, {displayModeBar:false, responsive:true});
  }
  ['strategy','underlying','start','end'].forEach(id => {
    document.getElementById(id).addEventListener('change', render);
  });

  render();
</script>
</body>
</html>
